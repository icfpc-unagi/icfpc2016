machine:
  java:
    version: oraclejdk8
  php:
    version: 7.0.7

dependencies:
  cache_directories:
    - ~/bazel-0.3.0
  pre:
    - ls -lA ~/
    - sudo apt-get update && sudo apt-get install g++-4.8 && sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.8 99
    - if [ ! -x ~/bazel-0.3.0/bin/bazel ]; then cd && git clone --depth=1 -b 0.3.0 https://github.com/bazelbuild/bazel.git bazel-0.3.0 && cd bazel-0.3.0 && EXTRA_BAZEL_ARGS='--jobs=1 --local_resources=2000,1,1' ./compile.sh; fi
    - echo 'build --package_path %workspace%:/home/ubuntu/bazel-0.3.0/base_workspace' > ~/.bazelrc
    - cd && mkdir -p ~/bin && ln -s ~/bazel-0.3.0/output/bazel ~/bin/bazel

test:
  override:
    - env
    - which php
    - php -v
    - bazel test -c opt --test_output=all //...
