machine:
  java:
    version: oraclejdk8
  php:
    version: 5.5.9

dependencies:
  cache_directories:
    - ~/bazel
  pre:
    - ls -lA ~/
    - sudo apt-get update && sudo apt-get install g++-4.8 && sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.8 99
    - if [ ! -d ~/bazel ]; then cd && git clone --depth=1 -b 0.3.0 https://github.com/bazelbuild/bazel.git && cd bazel && ./compile.sh; fi
    - echo 'build --package_path %workspace%:/home/ubuntu/bazel/base_workspace' > ~/.bazelrc
    - mkdir -p ~/bin && ln -s ~/bazel/output/bazel ~/bin/bazel

test:
  override:
    - env
    - which php
    - php -v
    - ~/bazel/output/bazel test -c opt --test_output=all //...
